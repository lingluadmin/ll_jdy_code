/**
 * Created by scofie on 8/22/17.
 */
var JdyApp = angular.module('jdyApp', [], function ($interpolateProvider) {
    $interpolateProvider.startSymbol('{%');
    $interpolateProvider.endSymbol('%}');
});
JdyApp.config(['$locationProvider', function($locationProvider) {
    // $locationProvider.html5Mode(true);
    $locationProvider.html5Mode({
        enabled: true,
        requireBase: false
    });
}]);
JdyApp.controller('investDetailCtrl',function ($scope,$http,$timeout,$filter,$location,$interval) {
    $scope.recordId =   0 ;
    $scope.recordId =   parseInt($location.search().record_id) ;
    $scope.jumpUrl  =   '/user/investList' ;
    if( $scope.recordId ==0 || !$scope.recordId ) {
        window.location.href = $scope.jumpUrl;
    }
    $scope.method       =   'GET' ;
    $scope.methodUrl    =   '/user/investDetail' ;
    $scope.params       =   {'record_id':$scope.recordId} ;
    $scope.code         =   '' ;
    $scope.data         =   {} ;
    $scope.investDetail =   {} ;
    $scope.refundList   =   {}  ;
    $scope.errorMsg     =   '' ;
    $scope.status       =   false ;
    $scope.pageShow     =   false ;
    $scope.isDisplay    =   false ;
    $timeout(function () {
        $http({method: $scope.method, url: $scope.methodUrl,params: $scope.params ,cache: false}).
        then(function successCallback(response) {
            $scope.code     =   response.status;
            $scope.data     =   response.data.data;
            if(  $scope.code ==200 ) {
                $scope.returnCode   =  $scope.data.code ;
                $scope.status       =  response.data.status
                $scope.errorMsg     =  response.data.msg ;
                if( $scope.status ==true ) {
                    $scope.investDetail =  $scope.data.invest_detail ;
                    $scope.refundList   =  $scope.data.refund_list ;
                    $scope.isDisplay    =   true;
                }else if($scope.status ==false && $scope.errorMsg !='' ) {
                    $scope.investDetail =  {'error':$scope.errorMsg}
                    $scope.refundList   =  {'error':$scope.errorMsg};
                }else {
                    console.log($scope.errorMsg);
                    window.location.href = $scope.jumpUrl;
                }
                $scope.pageShow     =   true ;
            } else {
                window.location.href = $scope.jumpUrl;
            }

        }, function errorCallback(response) {
            $scope.data     = response.data || 'Request failed';
            $scope.status   = response.status;
        })
    } ,200);

    $scope.isBlock = function (status) {
        var block = "none";
        if (status == true) {
            block = 'block';
        }
        return {"display": block};
    };

});
